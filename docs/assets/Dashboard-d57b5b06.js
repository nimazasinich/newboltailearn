var v=Object.defineProperty;var E=(r,s,t)=>s in r?v(r,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[s]=t;var g=(r,s,t)=>(E(r,typeof s!="symbol"?s+"":s,t),t);import{c as N,r as i,W as b,j as e,B as k,A as C,T as S}from"./index-42a0ee52.js";import{C as h,a as x,b as m,c as u}from"./Card-7dd85c47.js";import{P as A}from"./pie-chart-a847c49d.js";const P=N("BarChart",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]]),T=N("LineChart",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]),W="http://localhost:8000";class $ extends Error{constructor(s,t){super(t),this.status=s,this.name="ApiError"}}async function L(r,s){const t=await fetch(`${W}${r}`,{headers:{"Content-Type":"application/json",...s==null?void 0:s.headers},credentials:"include",...s});if(!t.ok)throw new $(t.status,`API Error: ${t.status} - ${t.statusText}`);return t.json()}function w(r,s,t=[]){const[n,a]=i.useState(null),[d,c]=i.useState(!0),[f,p]=i.useState(null),l=i.useCallback(async()=>{c(!0),p(null);try{const o=await L(r,s);a(o),c(!1)}catch(o){p((o==null?void 0:o.message)||"Error"),c(!1)}},[r,...t||[]]);return i.useEffect(()=>{l()},[l]),{data:n,loading:d,error:f,refetch:l}}class B{constructor(){g(this,"ws",null);g(this,"listeners",new Map);g(this,"attempts",0);g(this,"max",5)}url(){return b.startsWith("/")?`${location.protocol==="https:"?"wss:":"ws:"}//${location.host}${b}`:b}connect(){return new Promise((s,t)=>{try{this.ws=new WebSocket(this.url()),this.ws.onopen=()=>{this.attempts=0,s()},this.ws.onmessage=n=>{try{const a=JSON.parse(n.data);this.emit(a)}catch{}},this.ws.onclose=()=>{this.reconnect()},this.ws.onerror=n=>{t(n)}}catch(n){t(n)}})}reconnect(){this.attempts>=this.max||(this.attempts++,setTimeout(()=>this.connect().catch(()=>{}),this.attempts*1e3))}on(s,t){return this.listeners.has(s)||this.listeners.set(s,new Set),this.listeners.get(s).add(t),()=>this.listeners.get(s).delete(t)}emit(s){const t=this.listeners.get(s.type);t&&t.forEach(a=>a(s.data));const n=this.listeners.get("*");n&&n.forEach(a=>a(s))}send(s,t){this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify({type:s,data:t,timestamp:Date.now()}))}get connected(){var s;return((s=this.ws)==null?void 0:s.readyState)===WebSocket.OPEN}}const j=new B;function D(){const[r,s]=i.useState(!1),t=i.useRef([]);return i.useEffect(()=>{j.connect().then(()=>s(!0)).catch(()=>s(!1));const a=setInterval(()=>s(j.connected),1e3);return()=>{clearInterval(a),t.current.forEach(d=>d()),t.current=[]}},[]),{connected:r,subscribe:(a,d)=>{const c=j.on(a,d);return t.current.push(c),c},send:j.send.bind(j)}}function J(){const{data:r,loading:s,error:t}=w("/models"),{data:n,loading:a,error:d}=w("/monitoring"),{connected:c,subscribe:f}=D();return i.useEffect(()=>{const l=f("system:metrics",y=>{console.log("Received system metrics:",y)}),o=f("training:progress",y=>{console.log("Received training progress:",y)});return()=>{l(),o()}},[f]),s||a?e.jsx("div",{className:"flex items-center justify-center h-64",dir:"rtl",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"داشبورد پیشرفته"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"نمای جامع از عملکرد سیستم و مدل‌های آموزشی"}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"وضعیت اتصال:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${c?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:c?"متصل":"قطع شده"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(h,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"کل مدل‌ها"}),e.jsx(k,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(u,{children:e.jsx("div",{className:"text-2xl font-bold",children:Array.isArray(r)?r.length:0})})]}),e.jsxs(h,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"جلسات فعال"}),e.jsx(C,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(u,{children:e.jsx("div",{className:"text-2xl font-bold",children:Array.isArray(r)?r.filter(l=>l.status==="training").length:0})})]}),e.jsxs(h,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"متوسط دقت"}),e.jsx(S,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(u,{children:e.jsx("div",{className:"text-2xl font-bold",children:"87.5%"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(h,{children:[e.jsx(x,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5"}),"نمودار عملکرد مدل‌ها"]})}),e.jsx(u,{children:e.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"نمودار در حال توسعه است"})})]}),e.jsxs(h,{children:[e.jsx(x,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5"}),"روند آموزش"]})}),e.jsx(u,{children:e.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"نمودار در حال توسعه است"})})]})]}),e.jsxs(h,{children:[e.jsx(x,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5"}),"توزیع انواع مدل‌ها"]})}),e.jsx(u,{children:e.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"نمودار در حال توسعه است"})})]})]})}export{J as default};
//# sourceMappingURL=Dashboard-d57b5b06.js.map
