var v=Object.defineProperty;var k=(n,s,r)=>s in n?v(n,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[s]=r;var l=(n,s,r)=>k(n,typeof s!="symbol"?s+"":s,r);import{c as N,b as C,r as i,W as y,j as e,B as E,A as S,T as A}from"./index-B6t0c70J.js";import{C as h,a as x,b as m,c as u}from"./Card-CDS4LrTn.js";import{C as T}from"./chart-pie-DdhipBvx.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]],$=N("chart-line",W);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=[["path",{d:"M5 21v-6",key:"1hz6c0"}],["path",{d:"M12 21V9",key:"uvy0l4"}],["path",{d:"M19 21V3",key:"11j9sm"}]],_=N("chart-no-axes-column-increasing",P);class j extends Error{constructor(r,a,t){super(r);l(this,"status");l(this,"response");this.name="ApiError",this.status=a,this.response=t}}async function I(n,s={}){const r=new AbortController,a=setTimeout(()=>r.abort(),3e4);try{const t=await fetch(`${C}${n}`,{headers:{"Content-Type":"application/json",Accept:"application/json",...s.headers||{}},signal:r.signal,...s});if(clearTimeout(a),!t.ok){let c=null;try{c=await t.json()}catch{}throw new j((c==null?void 0:c.message)||`HTTP ${t.status}`,t.status,c)}return(t.headers.get("content-type")||"").includes("application/json")?await t.json():await t.text()}catch(t){throw clearTimeout(a),t.name==="AbortError"?new j("Request timeout",408):t instanceof j?t:new j((t==null?void 0:t.message)||"Network error",0)}}function b(n,s,r=[]){const[a,t]=i.useState(null),[o,c]=i.useState(!0),[p,d]=i.useState(null),w=i.useCallback(async()=>{c(!0),d(null);try{const g=await I(n,s);t(g),c(!1)}catch(g){d((g==null?void 0:g.message)||"Error"),c(!1)}},[n,...r||[]]);return i.useEffect(()=>{w()},[w]),{data:a,loading:o,error:p,refetch:w}}class L{constructor(){l(this,"ws",null);l(this,"listeners",new Map);l(this,"attempts",0);l(this,"max",5)}url(){return y.startsWith("/")?`${location.protocol==="https:"?"wss:":"ws:"}//${location.host}${y}`:y}connect(){return new Promise((s,r)=>{try{this.ws=new WebSocket(this.url()),this.ws.onopen=()=>{this.attempts=0,s()},this.ws.onmessage=a=>{try{const t=JSON.parse(a.data);this.emit(t)}catch{}},this.ws.onclose=()=>{this.reconnect()},this.ws.onerror=a=>{r(a)}}catch(a){r(a)}})}reconnect(){this.attempts>=this.max||(this.attempts++,setTimeout(()=>this.connect().catch(()=>{}),this.attempts*1e3))}on(s,r){return this.listeners.has(s)||this.listeners.set(s,new Set),this.listeners.get(s).add(r),()=>this.listeners.get(s).delete(r)}emit(s){const r=this.listeners.get(s.type);r&&r.forEach(t=>t(s.data));const a=this.listeners.get("*");a&&a.forEach(t=>t(s))}send(s,r){this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify({type:s,data:r,timestamp:Date.now()}))}get connected(){var s;return((s=this.ws)==null?void 0:s.readyState)===WebSocket.OPEN}}const f=new L;function M(){const[n,s]=i.useState(!1),r=i.useRef([]);return i.useEffect(()=>{f.connect().then(()=>s(!0)).catch(()=>s(!1));const t=setInterval(()=>s(f.connected),1e3);return()=>{clearInterval(t),r.current.forEach(o=>o()),r.current=[]}},[]),{connected:n,subscribe:(t,o)=>{const c=f.on(t,o);return r.current.push(c),c},send:f.send.bind(f)}}function J(){const{data:n,loading:s}=b("/models"),{loading:r}=b("/monitoring"),{connected:a,subscribe:t}=M();return i.useEffect(()=>{const c=t("system:metrics",d=>{console.log("Received system metrics:",d)}),p=t("training:progress",d=>{console.log("Received training progress:",d)});return()=>{c(),p()}},[t]),s||r?e.jsx("div",{className:"flex items-center justify-center h-64",dir:"rtl",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"داشبورد پیشرفته"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"نمای جامع از عملکرد سیستم و مدل‌های آموزشی"}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"وضعیت اتصال:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${a?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:a?"متصل":"قطع شده"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(h,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"کل مدل‌ها"}),e.jsx(E,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(u,{children:e.jsx("div",{className:"text-2xl font-bold",children:(n==null?void 0:n.length)||0})})]}),e.jsxs(h,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"جلسات فعال"}),e.jsx(S,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(u,{children:e.jsx("div",{className:"text-2xl font-bold",children:(n==null?void 0:n.filter(c=>c.status==="training").length)||0})})]}),e.jsxs(h,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"متوسط دقت"}),e.jsx(A,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(u,{children:e.jsx("div",{className:"text-2xl font-bold",children:"87.5%"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(h,{children:[e.jsx(x,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5"}),"نمودار عملکرد مدل‌ها"]})}),e.jsx(u,{children:e.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"نمودار در حال توسعه است"})})]}),e.jsxs(h,{children:[e.jsx(x,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),"روند آموزش"]})}),e.jsx(u,{children:e.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"نمودار در حال توسعه است"})})]})]}),e.jsxs(h,{children:[e.jsx(x,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5"}),"توزیع انواع مدل‌ها"]})}),e.jsx(u,{children:e.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"نمودار در حال توسعه است"})})]})]})}export{J as default};
